---
import MainLayout from '../layouts/nav.astro';
import { Image as AstroImage } from "astro:assets";

const illustrations = import.meta.glob('/src/assets/artwork/illustration/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });
const assets2D = import.meta.glob('/src/assets/artwork/2d/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });
const assets3D = import.meta.glob('/src/assets/artwork/3d/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });
const wip = import.meta.glob('/src/assets/artwork/wip/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });

const getFolderData = (globGroup: any) => {
  const entries = Object.entries(globGroup);
  if (entries.length === 0) return { cover: null, count: 0 };
  const coverEntry = entries.find(([path]) => {
    const fileName = path.split('/').pop()?.toUpperCase() || '';
    return fileName.startsWith('COVER_');
  }) || entries[0];

  return {
    cover: (coverEntry[1] as any).default,
    count: entries.length
  };
};

const categories = [
  { name: 'Illustration', link: '/1', data: getFolderData(illustrations) },
  { name: '2D Assets', link: '/2', data: getFolderData(assets2D) },
  { name: '3D Assets', link: '/3', data: getFolderData(assets3D) },
  { name: 'Work in Progress', link: '/4', data: getFolderData(wip) },
];
---

<MainLayout>
  <main class="min-h-screen w-full bg-[#fafafa] flex flex-col px-6 md:px-12 lg:px-16 py-8 selection:bg-black selection:text-white relative overflow-x-hidden">
    
    <div class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[40vw] font-italiana text-black/[0.01] pointer-events-none select-none z-0">
      01
    </div>

    <header class="mb-16 relative z-10">
      <div class="flex flex-col md:flex-row md:items-end justify-between gap-8">
        <div class="flex flex-col">
          <span class="text-[9px] tracking-[0.6em] text-gray-400 uppercase mb-2 block animate-fade">Visual Catalog</span>
          <h1 class="text-7xl md:text-9xl font-light tracking-[-0.03em] font-italiana text-gray-900 leading-[0.8]">
            ARTWORK
          </h1>
        </div>
        <div class="hidden md:block w-32 h-[1px] bg-gray-200 mb-4 animate-scale-line"></div>
      </div>
    </header>

    <section class="flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-10 gap-y-20 relative z-10">
      {categories.map((cat, index) => (
        <div class="perspective-wrapper relative">
          <a href={cat.link} class="category-card group relative flex flex-col outline-none" style={`animation-delay: ${index * 0.15}s`}>
            <div class="card-inner flex flex-col gap-6 transform-gpu transition-all duration-500 ease-out will-change-transform rounded-xl p-2 preserve-3d">
              <div class="relative preserve-3d">
                <span class="absolute -top-10 -left-4 text-6xl font-italiana text-yellow-500 z-20 opacity-0 group-hover:opacity-100 transition-all duration-700 pointer-events-none group-hover:translate-z-40">0{index + 1}</span>
                <div class="aspect-[3/4.5] w-full bg-white overflow-hidden relative shadow-sm group-hover:shadow-[0_40px_80px_-15px_rgba(0,0,0,0.25)] border border-transparent group-hover:border-zinc-100 transition-all duration-700 z-10">
                  {cat.data.cover ? (
                    <AstroImage src={cat.data.cover} alt={cat.name} width={800} height={1200} class="w-full h-full object-cover transition-all duration-1000 group-hover:scale-110" />
                  ) : (
                    <div class="absolute inset-0 flex items-center justify-center text-zinc-300 text-[9px] tracking-[0.4em] uppercase font-italiana font-bold">Empty</div>
                  )}
                  <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex items-center justify-center">
                    <span class="text-[10px] tracking-[0.5em] text-white uppercase font-bold border-b border-white/50 pb-1">View Archive</span>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-3 z-10">
                <h2 class="text-4xl font-light tracking-tight font-italiana text-gray-900 leading-none transition-all duration-500 group-hover:italic group-hover:translate-x-2">{cat.name}</h2>
                <div class="flex items-center justify-between">
                  <span class="text-[9px] text-gray-400 tracking-[0.4em] uppercase font-bold">{cat.data.count} Files</span>
                  <div class="h-[1px] w-0 group-hover:w-16 bg-gray-900 transition-all duration-700"></div>
                </div>
              </div>
            </div>
          </a>
        </div>
      ))}
    </section>

    <footer class="mt-32 mb-16 flex justify-end relative z-10">
      <a href="/all" class="group flex flex-col items-end gap-3">
        <span class="text-[11px] tracking-[0.4em] uppercase font-bold text-gray-900 group-hover:tracking-[0.6em] transition-all duration-500">
          Show All Works
        </span>
        <div class="flex flex-col items-end gap-[3px]">
          <div class="h-[1.5px] bg-black/10 w-40 overflow-hidden relative">
            <div class="absolute inset-0 bg-black group-hover:animate-wave-long origin-right"></div>
          </div>
          <div class="h-[1.5px] bg-black/10 w-24 overflow-hidden relative">
            <div class="absolute inset-0 bg-black group-hover:animate-wave-mid origin-right"></div>
          </div>
          <div class="h-[1.5px] bg-black/10 w-32 overflow-hidden relative">
            <div class="absolute inset-0 bg-black group-hover:animate-wave-short origin-right"></div>
          </div>
        </div>
      </a>
    </footer>

    <div id="cursor" class="fixed w-3 h-3 bg-black rounded-full pointer-events-none z-[9999] mix-blend-difference hidden md:block -translate-x-1/2 -translate-y-1/2"></div>
  </main>
</MainLayout>

<script>
  const cards = document.querySelectorAll('.category-card');
  const cursor = document.getElementById('cursor') as HTMLElement | null;

  document.addEventListener('mousemove', (e) => {
    if (cursor) {
      cursor.style.left = `${e.clientX}px`;
      cursor.style.top = `${e.clientY}px`;
    }
  });

  cards.forEach(card => {
    const inner = card.querySelector('.card-inner') as HTMLElement | null;
    const wrapper = card.closest('.perspective-wrapper') as HTMLElement | null;

    card.addEventListener('mousemove', (e) => {
      const ev = e as MouseEvent;
      const rect = card.getBoundingClientRect();
      const x = ev.clientX - rect.left;
      const y = ev.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = (y - centerY) / 12; 
      const rotateY = (centerX - x) / 12;

      if (inner && wrapper) {
        wrapper.style.zIndex = "100"; 
        inner.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05) translateZ(60px)`;
        inner.style.filter = `drop-shadow(${rotateY * -1.5}px ${rotateX * 1.5}px 30px rgba(0,0,0,0.25))`;
      }
      if (cursor) cursor.style.transform = 'scale(4)';
    });

    card.addEventListener('mouseleave', () => {
      if (inner && wrapper) {
        wrapper.style.zIndex = "10";
        inner.style.transform = `perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1) translateZ(0px)`;
        inner.style.filter = "none";
      }
      if (cursor) cursor.style.transform = 'scale(1)';
    });
  });
</script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Italiana&display=swap');
  .font-italiana { font-family: 'Italiana', serif; }

  .perspective-wrapper { perspective: 1500px; z-index: 10; }
  .preserve-3d { transform-style: preserve-3d; }
  .card-inner { transform-style: preserve-3d; transition: transform 0.4s ease-out, filter 0.4s ease-out; }
  .group-hover\:translate-z-40 { transform: translateZ(40px); }

  /* WAVE ANIMATIONS FOR BUTTON LINES */
  @keyframes wave {
    0%, 100% { transform: scaleX(1); }
    50% { transform: scaleX(0.6); }
  }

  .group-hover\:animate-wave-long {
    animation: wave 1.5s ease-in-out infinite;
    transform-origin: right;
  }
  .group-hover\:animate-wave-mid {
    animation: wave 1.5s ease-in-out infinite 0.2s; /* Delay biar bergelombang */
    transform-origin: right;
  }
  .group-hover\:animate-wave-short {
    animation: wave 1.5s ease-in-out infinite 0.4s; /* Delay biar bergelombang */
    transform-origin: right;
  }

  @keyframes fade { from { opacity: 0; } to { opacity: 1; } }
  .animate-fade { animation: fade 2s ease forwards; }
  @keyframes scale-line { from { transform: scaleX(0); } to { transform: scaleX(1); } }
  .animate-scale-line { animation: scale-line 1.5s ease-out forwards; transform-origin: left; }
</style>