---
import MainLayout from '../layouts/nav.astro';
import { Image as AstroImage } from "astro:assets";

// 1. Ambil semua asset dari tiap folder (eager: true agar metadata langsung siap)
const illustrations = import.meta.glob('/src/assets/artwork/illustration/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });
const assets2D = import.meta.glob('/src/assets/artwork/2d/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });
const assets3D = import.meta.glob('/src/assets/artwork/3d/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });
const wip = import.meta.glob('/src/assets/artwork/wip/*.{jpeg,jpg,png,gif,webp,avif,mp4,webm,mov}', { eager: true });

// 2. Fungsi Pintar untuk ambil Cover & Hitung Koleksi (Sinkron dengan logika 1.astro)
const getFolderData = (globGroup: any) => {
  const entries = Object.entries(globGroup);
  if (entries.length === 0) return { cover: null, count: 0 };

  // Cari file yang namanya diawali 'COVER_' (Case Insensitive)
  const coverEntry = entries.find(([path]) => {
    const fileName = path.split('/').pop()?.toUpperCase() || '';
    return fileName.startsWith('COVER_');
  }) || entries[0]; // Fallback ke file pertama kalau gak ada penanda COVER_

  return {
    cover: (coverEntry[1] as any).default,
    count: entries.length
  };
};

const categories = [
  { name: 'Illustration', link: '/1', data: getFolderData(illustrations) },
  { name: '2D Assets', link: '/2', data: getFolderData(assets2D) },
  { name: '3D Assets', link: '/3', data: getFolderData(assets3D) },
  { name: 'Work in Progress', link: '/4', data: getFolderData(wip) },
];
---

<MainLayout>
  <main class="min-h-screen w-full bg-white flex flex-col px-8 md:px-20 py-12 overflow-y-auto selection:bg-red-50">
    
    <header class="mb-16 md:mb-20 animate-[anitext_1s_ease-in-out]">
      <div class="flex items-baseline gap-4">
        <h1 class="text-4xl md:text-5xl font-light tracking-[0.2em] font-italiana text-gray-900">ARTWORK</h1>
        <div class="h-[1px] flex-1 bg-gray-200"></div>
        <span class="text-[10px] tracking-[0.5em] text-gray-400 uppercase hidden sm:block">Archive 01</span>
      </div>
    </header>

    <section class="flex-1 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-12 md:gap-16 items-start pb-24">
      {categories.map((cat, index) => (
        <a href={cat.link} class="group relative flex flex-col gap-6 animate-[anitext_1s_ease-in-out]" style={`animation-delay: ${index * 0.1}s`}>
          
          <div class="aspect-[3/4] bg-zinc-50 border border-zinc-100 rounded-sm overflow-hidden relative transition-all duration-700 group-hover:shadow-[0_30px_60px_-15px_rgba(0,0,0,0.1)] group-hover:-translate-y-2">
            {cat.data.cover ? (
              <AstroImage 
                src={cat.data.cover} 
                alt={cat.name}
                width={600}
                height={800}
                class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110"
              />
            ) : (
              <div class="absolute inset-0 flex items-center justify-center text-zinc-300 text-[10px] tracking-[0.3em] uppercase italic">
                Empty Folder
              </div>
            )}
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"></div>
          </div>

          <div class="flex flex-col gap-2">
            <div class="flex justify-between items-center border-b border-gray-100 pb-2">
              <span class="text-[10px] text-gray-400 font-serif italic">0{index + 1}</span>
              <span class="text-[9px] text-gray-400 tracking-[0.2em] uppercase font-bold">{cat.data.count} Items</span>
            </div>
            <h2 class="text-xl md:text-2xl font-light tracking-widest font-italiana text-gray-800 group-hover:translate-x-2 transition-transform duration-500">
              {cat.name}
            </h2>
          </div>
        </a>
      ))}
    </section>

    <footer class="mt-auto pt-12 flex flex-col md:flex-row justify-between items-center md:items-end gap-8 border-t border-gray-100">
      <p class="text-[10px] text-gray-400 max-w-[250px] leading-relaxed tracking-wide text-center md:text-left italic">
        A curated selection of digital assets and illustrations developed by Resillust.
      </p>
      
      <a href="/all" class="group flex flex-col items-center md:items-end gap-2 mb-4 md:mb-0">
        <span class="text-[11px] tracking-[0.5em] text-gray-900 font-bold group-hover:pr-4 transition-all uppercase">Show all works</span>
        <div class="flex flex-col gap-1 w-full items-center md:items-end">
          <span class="w-20 h-[1px] bg-gray-900 transition-all group-hover:w-24"></span>
          <span class="w-12 h-[1px] bg-gray-900 transition-all group-hover:w-24"></span>
        </div>
      </a>
    </footer>

  </main>
</MainLayout>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Italiana&display=swap');
  
  .font-italiana { font-family: 'Italiana', serif; }

  @keyframes anitext {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  main::-webkit-scrollbar { display: none; }
  main { -ms-overflow-style: none; scrollbar-width: none; }
</style>